server:
  port: 8093

spring:
  cloud:
    gateway:
      server:
        webflux:
          routes:
          # AUTENTICACIÓN - RUTAS PÚBLICAS
            # LOGIN - Ruta pública
            - id: auth-login
              uri: http://localhost:8098  # URI del MS-Authentication
              predicates:
                - Path=/api/v1/gateway/auth/login
                - Method=POST
              filters:
                - RewritePath=/api/v1/gateway/auth/login, /api/auth/login

            # CREAR CLIENTE - Ruta pública
            - id: auth-create-client
              uri: http://localhost:8098
              predicates:
                - Path=/api/v1/gateway/auth/createclient
                - Method=POST
              filters:
                - RewritePath=/api/v1/gateway/auth/createclient, /api/auth/createclient

            # REFRESH TOKEN - Ruta pública
            - id: auth-refresh
              uri: http://localhost:8098
              predicates:
                - Path=/api/v1/gateway/auth/refresh
                - Method=POST
              filters:
                - RewritePath=/api/v1/gateway/auth/refresh, /api/auth/refresh

          # AUTENTICACIÓN - RUTAS PROTEGIDAS
            # CREAR ADMIN - Requiere permiso usuarios:crear_admin
            - id: auth-create-admin
              uri: http://localhost:8098
              predicates:
                - Path=/api/v1/gateway/auth/createadmin
                - Method=POST
              filters:
                - AuthorizationFilter=CreateAdmin
                - RewritePath=/api/v1/gateway/auth/createadmin, /api/auth/createadmin
            # UPDATE INFO USER - Requiere permiso usuarios
            - id: auth-update-userinfo
              uri: http://localhost:8098
              predicates:
                - Path=/api/v1/gateway/auth/updateuserinfo
                - Method=PUT,PATCH
              filters:
                - AuthorizationFilter=UpdateUserInfo
                - RewritePath=/api/v1/gateway/auth/updateuserinfo, /api/auth/updateuserinfo
          # INVENTARIO - RUTAS PUBLICAS
            # PRODUCTOS - LISTAR 
            - id: productos-listar-public
              uri: http://localhost:8080
              predicates:
                - Path=/api/v1/gateway/productos/listar
                - Method=GET
              filters:
                - RewritePath=/api/v1/gateway/productos/listar, /api/v1/productos/listar
            
            # PRODUCTOS - BUSCAR POR ID
            - id: productos-buscarID-public
              uri: http://localhost:8080
              predicates:
                - Path=/api/v1/gateway/productos/buscar/{id}
                - Method=GET
              filters:
                - RewritePath=/api/v1/gateway/productos/buscar/(?<id>.*), /api/v1/productos/buscar/${id}
            
            # PRODUCTOS - BUSCAR POR NOMBRE
            - id: productos-buscar-nombre-public
              uri: http://localhost:8080
              predicates:
                - Path=/api/v1/gateway/productos/buscarProductos/{nombre}
                - Method=GET
              filters:
                - RewritePath=/api/v1/gateway/productos/buscarProductos/(?<nombre>.*), /api/v1/productos/buscarProductos/${nombre}
          
          # INVENTARIO - RUTAS PROTEGIDAS
            # PRODUCTOS - CREAR PRODUCTO
            - id: productos-crear
              uri: http://localhost:8080
              predicates:
                - Path=/api/v1/gateway/productos/crear
                - Method=POST
              filters:
                - AuthorizationFilter=Inventario:Crud
                - RewritePath=/api/v1/gateway/productos/crear, /api/v1/productos/crear
            
            # PRODUCTOS - ACTUALIZAR PRODUCTO
            - id: productos-actualizar
              uri: http://localhost:8080
              predicates:
                - Path=/api/v1/gateway/productos/actualizar/{query}
                - Method=PUT,PATCH
              filters:
                - AuthorizationFilter=Inventario:Crud
                - RewritePath=/api/v1/gateway/productos/actualizar/(?<query>.*), /api/v1/productos/actualizar/${query}
            
            # PRODUCTOS - ELIMINAR PRODUCTO
            - id: productos-eliminar
              uri: http://localhost:8080
              predicates:
                - Path=/api/v1/gateway/productos/baja/{id}
                - Method=DELETE
              filters:
                - AuthorizationFilter=Inventario:Crud
                - RewritePath=/api/v1/gateway/productos/baja/(?<id>.*), /api/v1/productos/baja/${id}

            # HISTORIAL STOCK - VER HISTORIAL POR ID DE PRODUCTO
            - id: historial-stock-por-producto
              uri: http://localhost:8080
              predicates:
                - Path=/api/v1/gateway/productos/historial-stock/{id}
                - Method=GET
              filters:
                - AuthorizationFilter=Inventario:Crud
                - RewritePath=/api/v1/gateway/productos/historial-stock/(?<id>.*), /api/v1/productos/historial-stock/${id}

            # PRODUCTOS CON STOCK BAJO
            - id: productos-stock-bajo
              uri: http://localhost:8080
              predicates:
                - Path=/api/v1/gateway/productos/stock-bajo
                - Method=GET
              filters:
                - AuthorizationFilter=Inventario:Crud
                - RewritePath=/api/v1/gateway/productos/stock-bajo, /api/v1/productos/stock-bajo
                
            # CATEGORIAS - CREAR CATEGORIA
            - id: categorias-crear
              uri: http://localhost:8080
              predicates:
                - Path=/api/v1/gateway/categoria/nuevacategoria
                - Method=POST
              filters:
                - AuthorizationFilter=Inventario:Crud
                - RewritePath=/api/v1/gateway/categoria/nuevacategoria, /api/v1/categoria/nuevacategoria

            # CATEGORIAS - OPTENER TODAS LAS CATEGORIAS
            - id: categorias-obtener-todas
              uri: http://localhost:8080
              predicates:
                - Path=/api/v1/gateway/categoria
                - Method=GET
              filters:
                - AuthorizationFilter=Inventario:Crud
                - RewritePath=/api/v1/gateway/categoria, /api/v1/categoria
            
            # CATEGORIAS - ACTUALIZAR CATEGORIA
            - id: categorias-actualizar
              uri: http://localhost:8080
              predicates:
                - Path=/api/v1/gateway/categoria/{id}
                - Method=PUT,PATCH
              filters:
                - AuthorizationFilter=Inventario:Crud
                - RewritePath=/api/v1/gateway/categoria/(?<id>.*), /api/v1/categoria/${id}

            # CATEGORIAS - ELIMINAR CATEGORIA
            - id: categorias-eliminar
              uri: http://localhost:8080
              predicates:
                - Path=/api/v1/gateway/categoria/{id}
                - Method=DELETE
              filters:
                - AuthorizationFilter=Inventario:Crud
                - RewritePath=/api/v1/gateway/categoria/(?<id>.*), /api/v1/categoria/${id}

            # CART - RUTAS PROTEGIDAS
              # CART - agregar producto al carrito
            - id: cart-agregar-producto
              uri: http://localhost:8090
              predicates:
                - Path=/api/v1/gateway/carts/agregarproducto
                - Method=POST
              filters:
                - AuthorizationFilter=Cart:Crud
                - RewritePath=/api/v1/gateway/carts/agregarproducto, /api/v1/carts/agregarproducto
                
            # CART - eliminar producto del carrito
            - id: cart-eliminar-producto
              uri: http://localhost:8090
              predicates:
                - Path=/api/v1/gateway/carts/eliminarproducto/{id}
                - Method=DELETE
              filters:
                - AuthorizationFilter=Cart:Crud
                - RewritePath=/api/v1/gateway/carts/eliminarproducto/(?<id>.*), /api/v1/carts/eliminarproducto/${id}
            # CART - ver carrito por ID de usuario
            - id: cart-ver-carrito
              uri: http://localhost:8090
              predicates:
                - Path=/api/v1/gateway/carts/vercarrito
                - Method=GET
              filters:
                - AuthorizationFilter=Cart:Crud
                - RewritePath=/api/v1/gateway/carts/vercarrito, /api/v1/carts/vercarrito
            # CART - vaciar carrito por ID de usuario
            - id: cart-vaciar-carrito
              uri: http://localhost:8090
              predicates:
                - Path=/api/v1/gateway/carts/vaciarcarrito
                - Method=DELETE
              filters:
                - AuthorizationFilter=Cart:Crud
                - RewritePath=/api/v1/gateway/carts/vaciarcarrito, /api/v1/carts/vaciarcarrito
            # CART - finalizar compra
            - id: cart-finalizar-compra
              uri: http://localhost:8090
              predicates:
                - Path=/api/v1/gateway/carts/realizarcompra
                - Method=GET
              filters:
                - AuthorizationFilter=Cart:Crud
                - RewritePath=/api/v1/gateway/carts/realizarcompra, /api/v1/carts/realizarcompra

            # CART ADMIN - ver todos los carritos (requiere permiso CartAdmin:Crud)
            - id: cart-ver-todos-carritos 
              uri: http://localhost:8090
              predicates:
                - Path=/api/v1/gateway/cartsadmin/all
                - Method=GET
              filters:
                - AuthorizationFilter=CartAdmin:Crud
                - RewritePath=/api/v1/gateway/cartsadmin/all, /api/v1/cartsadmin/all
           
            # CART ADMIN - ver carritos abandonados (requiere permiso CartAdmin:Crud)
            - id: cart-ver-carritos-abandonados
              uri: http://localhost:8090
              predicates:
                - Path=/api/v1/gateway/cartsadmin/cartabandonados
                - Method=GET
              filters:
                - AuthorizationFilter=CartAdmin:Crud
                - RewritePath=/api/v1/gateway/cartsadmin/cartabandonados, /api/v1/cartsadmin/cartabandonados

            # CART ADMIN - ver carritos por ID del Carrito (requiere permiso CartAdmin:Crud)
            - id: cart-ver-carrito-por-id
              uri: http://localhost:8090
              predicates:
                - Path=/api/v1/gateway/cartsadmin/cartid/{id}
                - Method=GET
              filters:
                - AuthorizationFilter=CartAdmin:Crud
                - RewritePath=/api/v1/gateway/cartsadmin/cartid/(?<id>.*), /api/v1/cartsadmin/cartid/${id}
            # ORDEN - Editar orden por usuario
            - id: Editar-orden-por-usuario
              uri: http://localhost:8095
              predicates:
                - Path=/api/v1/gateway/ordenes/editarorden
                - Method=POST
              filters:
                - AuthorizationFilter=Orden:Crud
                - RewritePath=/api/v1/gateway/ordenes/editarorden, /api/v1/ordenes/editarorden
            # ORDEN - CONFIRMAR ORDEN
            - id: Confirmar-orden
              uri: http://localhost:8095
              predicates:
                - Path=/api/v1/gateway/ordenes/confirmarorden
                - Method=GET
              filters:
                - AuthorizationFilter=Orden:Crud
                - RewritePath=/api/v1/gateway/ordenes/confirmarorden, /api/v1/ordenes/confirmarorden
            
            # ORDEN ADMIN - poner en despacho una orden
            - id: Poner-en-despacho-orden
              uri: http://localhost:8095
              predicates:
                - Path=/api/v1/gateway/ordenes/admin/despacharorden/{id}
                - Method=PATCH
              filters:
                - AuthorizationFilter=OrdenAdmin:Crud
                - RewritePath=/api/v1/gateway/ordenes/admin/despacharorden/(?<id>.*), /api/v1/ordenes/admin/despacharorden/${id}
            # ORDEN ADMIN - poner en orden entregada 
            - id: entregada-una-orden
              uri: http://localhost:8095
              predicates:
                - Path=/api/v1/gateway/ordenes/admin/entregarorden/{id}
                - Method=PATCH
              filters:
                - AuthorizationFilter=OrdenAdmin:Crud
                - RewritePath=/api/v1/gateway/ordenes/admin/entregarorden/(?<id>.*), /api/v1/ordenes/admin/entregarorden/${id}
            
            # ORDEN ADMIN - ver todas las ordenes
            - id: ver-todas-las-ordenes
              uri: http://localhost:8095
              predicates:
                - Path=/api/v1/gateway/ordenes/admin/todaslasordenes
                - Method=GET
              filters:
                - AuthorizationFilter=OrdenAdmin:Crud
                - RewritePath=/api/v1/gateway/ordenes/admin/todaslasordenes, /api/v1/ordenes/admin/todaslasordenes
            
            # ORDEN ADMIN - ver detalle de una orden por ID
            - id: ver-detalle-orden-por-id
              uri: http://localhost:8095
              predicates:
                - Path=/api/v1/gateway/ordenes/admin/detalleorden/{id}
                - Method=GET
              filters:
                - AuthorizationFilter=OrdenAdmin:Crud
                - RewritePath=/api/v1/gateway/ordenes/admin/detalleorden/(?<id>.*), /api/v1/ordenes/admin/detalleorden/${id}

            # ORDEN CLIENTE - eliminar producto de una orden por ID de producto
            - id: eliminar-orden-por-usuario
              uri: http://localhost:8095
              predicates:
                - Path=/api/v1/gateway/ordenes/eliminarproducto/{id}
                - Method=DELETE
              filters:
                - AuthorizationFilter=Orden:Crud
                - RewritePath=/api/v1/gateway/ordenes/eliminarproducto/(?<id>.*), /api/v1/ordenes/eliminarproducto/${id}
            # ORDEN ADMIN - VER TODAS LAS ORDENES
            - id: ver-todas-las-ordenes-admin
              uri: http://localhost:8095
              predicates:
                - Path=/api/v1/gateway/ordenes/admin/todaslasordenes
                - Method=GET
              filters:
                - AuthorizationFilter=OrdenAdmin:Crud
                - RewritePath=/api/v1/gateway/ordenes/admin/todaslasordenes, /api/v1/ordenes/admin/todaslasordenes
            
            # ORDEN ADMIN - MOSTAR ORDEN POR ID
            - id: mostrar-orden-por-id-admin
              uri: http://localhost:8095
              predicates:
                - Path=/api/v1/gateway/ordenes/admin/detalleorden/{id}
                - Method=GET
              filters:
                - AuthorizationFilter=OrdenAdmin:Crud
                - RewritePath=/api/v1/gateway/ordenes/admin/detalleorden/(?<id>.*), /api/v1/ordenes/admin/detalleorden/${id}
            

    discovery:
      locator:
        enabled: true
        lower-case-service-id: true

logging:
  level:
    org.springframework.cloud: DEBUG
    org.springframework.cloud.gateway: DEBUG
    org.springframework.cloud.gateway.route.RouteDefinitionLocator: DEBUG
jwt:
  secret-key: 4ba2e4c6c0eab7c2ed629fbdc76ac515a9a82d1d41ebfc483060ab8816544aa6
  expiration: 3600000
